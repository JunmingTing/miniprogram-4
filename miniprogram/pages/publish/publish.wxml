<!--发布页面-->
<view class="publish-container">
  <!-- 图片上传区域 -->
  <view class="upload-section">
    <view class="upload-grid">
      <!-- 已上传的图片 -->
      <view class="image-item" wx:for="{{tempImages}}" wx:key="index">
        <t-image 
          src="{{item}}" 
          class="uploaded-image"
          mode="aspectFill"
          width="160rpx"
          height="160rpx"
        />
        <view class="delete-btn" bind:tap="onDeleteImage" data-index="{{index}}">
          <t-icon name="close" size="24rpx" color="#fff" />
        </view>
        <!-- 上传状态指示器 -->
        <view class="upload-status" wx:if="{{uploading && index >= images.length}}">
          <t-icon name="loading" size="24rpx" color="#fff" />
        </view>
        <!-- 设为头像按钮 -->
        <view class="set-avatar-btn" wx:if="{{!uploading && index < images.length}}" bind:tap="onSetAvatar" data-index="{{index}}">
          <t-icon name="user" size="20rpx" color="#fff" />
        </view>
      </view>
      
      <!-- 添加图片按钮 -->
      <view class="add-image-btn" wx:if="{{images.length < 5 && !uploading}}" bind:tap="onAddImage">
        <t-icon name="add" size="60rpx" color="#ccc" />
      </view>
    </view>
    
    <!-- 上传进度提示 -->
    <view class="upload-progress" wx:if="{{uploading}}">
      <text class="progress-text">正在上传图片...</text>
    </view>
    
    <text class="upload-tip">最多上传5张图片</text>
    <text class="avatar-tip" wx:if="{{images.length > 0}}">💡 点击图片右下角的头像图标可设为个人头像</text>
    
    <!-- 手动上传按钮 -->
    <view class="manual-upload-btn" wx:if="{{tempImages.length > images.length && !uploading}}" bind:tap="onManualUpload">
      <t-icon name="cloud-upload" size="32rpx" color="#4F46E5" />
      <text class="upload-btn-text">上传到云存储</text>
    </view>
  </view>

  <!-- 标签管理区域 -->
  <view class="tags-section">
    <view class="section-title">添加标签</view>
    
    <!-- 已添加的标签 -->
    <view class="tags-list" wx:if="{{tags.length > 0}}">
      <view class="tag-item" wx:for="{{tags}}" wx:key="index">
        <t-tag 
          theme="primary" 
          size="small" 
          closable
          bind:close="onDeleteTag"
          data-index="{{index}}"
        >
          {{item}}
        </t-tag>
      </view>
    </view>

    <!-- 添加标签输入框 -->
    <view class="tag-input-container">
      <input 
        class="tag-input" 
        placeholder="输入标签内容（最多12字）" 
        value="{{tagInput}}"
        maxlength="12"
        bind:input="onTagInputChange"
        bind:confirm="onAddTag"
      />
      <t-button 
        theme="primary" 
        size="small" 
        bind:tap="onAddTag"
        disabled="{{!tagInput.trim()}}"
        class="add-tag-btn"
      >
        添加
      </t-button>
    </view>
  </view>

  <!-- 发布按钮 -->
  <view class="publish-section">
    <t-button 
      theme="primary" 
      size="large" 
      block
      bind:tap="onPublish"
      disabled="{{images.length === 0 || uploading}}"
      loading="{{publishing}}"
    >
      {{uploading ? '上传中...' : (publishing ? '发布中...' : '发布')}}
    </t-button>
  </view>
</view>

<!-- Toast提示 -->
<t-toast id="t-toast" />
