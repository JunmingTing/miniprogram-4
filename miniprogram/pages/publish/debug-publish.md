# 发布功能调试指南

## 问题排查步骤

### 1. 检查云开发环境
- 确保在微信开发者工具中已开通云开发
- 检查环境ID是否正确：`cloud1-4ghl6bw58e8ba561`
- 在控制台查看是否有"云开发环境初始化完成"的日志

### 2. 检查云函数部署
- 确保 `login` 云函数已部署
- 在微信开发者工具中右键点击 `cloudfunctions/login` 文件夹
- 选择"上传并部署：云端安装依赖"

### 3. 检查数据库集合
- 在云开发控制台中创建 `posts` 集合
- 设置集合权限为"所有用户可读写"

### 4. 测试步骤
1. 选择图片（确保图片大小不超过5MB）
2. 添加标签（可选）
3. 点击发布按钮
4. 查看控制台日志

### 5. 常见错误及解决方案

#### 错误1: "云开发环境未初始化"
**解决方案**: 检查 `app.ts` 中的云开发初始化代码

#### 错误2: "获取用户信息失败"
**解决方案**: 检查 `login` 云函数是否已部署

#### 错误3: "数据库权限不足"
**解决方案**: 在云开发控制台设置数据库权限

#### 错误4: "数据库集合不存在"
**解决方案**: 在云开发控制台创建 `posts` 集合

## 调试日志
发布功能会在控制台输出详细的调试信息，包括：
- 图片上传状态
- 用户信息获取结果
- 数据库保存结果
- 错误详情

## 测试建议
1. 先测试选择图片功能
2. 再测试图片上传功能
3. 最后测试完整发布流程
