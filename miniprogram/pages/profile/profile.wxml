<!--我的页面-->
<view class="profile-container">
  <!-- 用户信息区域 -->
  <view class="user-section">
    <view class="user-info" wx:if="{{isLoggedIn}}">
      <view class="user-avatar-container" bind:tap="onAvatarTap">
        <image 
          src="{{userInfo.avatar}}" 
          class="user-avatar"
          mode="aspectFill"
          wx:if="{{userInfo.avatar}}"
        />
        <view class="user-avatar-placeholder" wx:else>
          <t-icon name="user" size="80rpx" color="#ccc" />
        </view>
      </view>
      <view class="user-details">
        <text class="user-name" bind:tap="onNicknameTap">{{userInfo.nickName}}</text>
        <text class="user-desc">点击设置头像昵称</text>
      </view>
    </view>
    
    <!-- 未登录状态 -->
    <view class="login-section" wx:else bind:tap="onLoginTap">
      <t-avatar 
        src="https://via.placeholder.com/160x160/4F46E5/FFFFFF?text=头像" 
        size="160rpx"
        class="user-avatar"
      />
      <view class="user-details">
        <text class="user-name">点击登录</text>
        <text class="user-desc">使用微信一键登录</text>
      </view>
      <t-icon name="chevron-right" size="32rpx" color="#ccc" />
    </view>
  </view>

  <!-- 功能菜单 -->
  <view class="menu-section">
    <t-cell-group>
      <!-- 我的收藏 -->
      <t-cell 
        title="我的收藏" 
        description="查看收藏的资讯"
        left-icon="bookmark"
        right-icon="chevron-right"
        bind:tap="onMyFavoritesTap"
        class="menu-cell"
      />
    </t-cell-group>
  </view>

  <!-- 测试功能区域 -->
  <view class="test-section">
    <view class="section-title">
      <t-icon name="experiment" size="32rpx" color="#4F46E5" />
      <text class="title-text">图片上传测试</text>
    </view>
    
    <view class="test-content">
      <!-- 当前测试图片显示 -->
      <view class="test-image-container" wx:if="{{testImage}}">
        <view class="test-image-wrapper">
          <t-image 
            src="{{testImage}}" 
            class="test-image"
            mode="aspectFill"
            width="300rpx"
            height="300rpx"
          />
          <view class="image-info">
            <text class="image-path">{{testImagePath}}</text>
            <text class="upload-time">{{testImageTime}}</text>
          </view>
        </view>
      </view>
      
      <!-- 无图片时的占位 -->
      <view class="test-placeholder" wx:else>
        <t-icon name="image" size="80rpx" color="#ccc" />
        <text class="placeholder-text">暂无测试图片</text>
      </view>
      
      <!-- 操作按钮 -->
      <view class="test-actions">
        <t-button 
          theme="primary" 
          size="large" 
          bind:tap="onTestUploadTap"
          loading="{{uploadingTest}}"
        >
          {{testImage ? '重新上传' : '选择图片'}}
        </t-button>
        
        <t-button 
          theme="danger" 
          variant="outline" 
          size="large" 
          bind:tap="onTestDeleteTap"
          wx:if="{{testImage}}"
          loading="{{deletingTest}}"
        >
          删除图片
        </t-button>
      </view>
      
      <!-- 功能说明 -->
      <view class="test-description">
        <text class="desc-text">• 图片将上传到云存储 /images 目录</text>
        <text class="desc-text">• 每次上传会自动删除旧图片</text>
        <text class="desc-text">• 支持实时预览和删除功能</text>
      </view>
    </view>
  </view>

  <!-- 其他功能 -->
  <view class="other-section">
    <t-cell-group>
      <!-- 设置 -->
      <t-cell 
        title="设置" 
        description="应用设置和偏好"
        left-icon="setting"
        right-icon="chevron-right"
        bind:tap="onSettingsTap"
        class="menu-cell"
      />
      
      
      <!-- 关于我们 -->
      <t-cell 
        title="关于我们" 
        description="了解更多信息"
        left-icon="help-circle"
        right-icon="chevron-right"
        bind:tap="onAboutTap"
        class="menu-cell"
      />
    </t-cell-group>
  </view>

  <!-- 退出登录按钮 -->
  <view class="logout-section" wx:if="{{isLoggedIn}}">
    <t-button 
      theme="danger" 
      variant="outline" 
      size="large" 
      block
      bind:tap="onLogoutTap"
    >
      退出登录
    </t-button>
  </view>
</view>


<!-- 头像上传弹窗 -->
<avatar-upload-dialog
  visible="{{showAvatarDialog}}"
  current-avatar="{{userInfo.avatar}}"
  user-id="{{userInfo._id}}"
  bind:close="onAvatarDialogClose"
  bind:upload-success="onAvatarUploadSuccess"
/>

<!-- Toast提示 -->
<t-toast id="t-toast" />
