<!--精彩时刻页面 - 个人图片展示-->
<view class="community-container">
  <!-- 顶部工具栏 -->
  <view class="toolbar">
    <view class="toolbar-left">
      <text class="page-title">精彩时刻</text>
    </view>
    <view class="toolbar-right">
      <view class="refresh-btn" bind:tap="refreshAllImages">
        <t-icon name="refresh" size="32rpx" color="#666" />
      </view>
    </view>
  </view>

  <!-- 固定发布按钮 -->
  <view class="fixed-publish-btn" bind:tap="onPublishTap">
    <t-icon name="add" size="40rpx" color="#fff" />
  </view>

  <!-- 帖子列表 -->
  <view class="posts-list">
    <view class="post-item" wx:for="{{posts}}" wx:key="id" bind:tap="onPostTap" data-post="{{item}}">

      <!-- 图片轮播 - 全屏显示 -->
      <view class="post-images-container" wx:if="{{item.images.length > 0}}">
        <swiper 
          class="post-swiper-fullscreen"
          current="{{item.currentImageIndex || 0}}"
          bindchange="onImageChange"
          data-post-id="{{item.id}}"
          indicator-dots="{{false}}"
          circular="{{item.images.length > 1}}"
          autoplay="{{false}}"
          interval="5000"
          duration="300"
        >
          <swiper-item wx:for="{{item.images}}" wx:key="index" wx:for-item="image">
            <image 
              src="{{image}}" 
              class="post-image-fullscreen"
              mode="widthFix"
              bind:load="onImageLoad"
              bind:error="onImageError"
              data-post-id="{{item.id}}"
              data-image-index="{{index}}"
              lazy-load="{{false}}"
            />
          </swiper-item>
        </swiper>
        
        <!-- 简洁的图片指示器 -->
        <view class="image-dots" wx:if="{{item.images.length > 1}}">
          <view 
            class="dot {{index === (item.currentImageIndex || 0) ? 'active' : ''}}" 
            wx:for="{{item.images}}" 
            wx:key="index"
          ></view>
        </view>
      </view>

      <!-- 标签区域 -->
      <view class="post-tags">
        <view class="tag-item" wx:for="{{item.tags}}" wx:key="id" catchtap="onTagTap" data-tag="{{item}}">
          <t-tag 
            theme="{{item.isLiked ? 'warning' : 'default'}}"
            size="small"
            class="post-tag"
          >
            {{item.text}}
          </t-tag>
        </view>
        <!-- 添加标签按钮 -->
        <view class="add-tag-btn" catchtap="onAddTagTap" data-id="{{item.id}}">
          <t-icon name="add" size="24rpx" color="#999" />
          <text class="add-tag-text">添加标签</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 加载更多 -->
  <view class="load-more" wx:if="{{loading && posts.length > 0}}">
    <t-loading size="40rpx" />
    <text class="load-text">加载更多...</text>
  </view>

  <!-- 初次加载状态 -->
  <view class="initial-loading" wx:if="{{loading && posts.length === 0}}">
    <t-loading size="60rpx" />
    <text class="loading-text">正在加载精彩时刻...</text>
  </view>

  <!-- 空状态 -->
  <view class="empty-state" wx:if="{{!loading && posts.length === 0}}">
    <t-empty 
      icon="image" 
      description="{{userInfo.openId ? '还没有发布过精彩时刻' : '登录后查看精彩时刻'}}" 
    >
      <view class="empty-actions">
        <t-button wx:if="{{userInfo.openId}}" 
          theme="primary" 
          size="medium" 
          bind:tap="onPublishTap"
          class="empty-publish-btn"
        >
          发布第一个时刻
        </t-button>
        <t-button wx:else
          theme="primary" 
          size="medium" 
          bind:tap="onLoginTap"
          class="empty-login-btn"
        >
          立即登录
        </t-button>
      </view>
    </t-empty>
  </view>
</view>



<!-- Toast提示 -->
<t-toast id="t-toast" />
